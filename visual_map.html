
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clinical Wisdom Map</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: false, theme: 'base' });
        window.mermaid = mermaid;
    </script>
    <script src="https://cdn.jsdelivr.net/npm/svg-pan-zoom@3.6.1/dist/svg-pan-zoom.min.js"></script>
    
    <style>
        body { background-color: #f8fafc; height: 100vh; overflow: hidden; }
        #container { width: 100%; height: 100%; display: flex; flex-direction: column; }
        #diagram-wrapper { flex-grow: 1; border: 1px solid #e2e8f0; background: white; overflow: hidden; position: relative; }
        #mermaid-output { width: 100%; height: 100%; }
        /* Ensure hidden pre tag is actually hidden */
        pre.mermaid-source { display: none; }
        .controls { position: absolute; bottom: 20px; right: 20px; z-index: 10; display: flex; gap: 10px; }
    </style>
</head>
<body>
    <div id="container">
        <header class="bg-white shadow-sm p-4 z-10">
            <h1 class="text-xl font-bold text-slate-800">Grand Rounds: Clinical Reasoning Map</h1>
            <p class="text-sm text-slate-500">Visualizing the evolution of medical consensus.</p>
        </header>

        <div id="diagram-wrapper">
            <div class="controls">
                <button onclick="resetZoom()" class="bg-slate-800 text-white px-4 py-2 rounded shadow hover:bg-slate-700 transition">Reset View</button>
            </div>
            
            <!-- Hidden source block -->
            <pre class="mermaid-source" id="graph-definition">
graph TD
    classDef Phase1 fill:#e0f7fa,stroke:#00796b,stroke-width:2px;
    classDef Phase2 fill:#fff3e0,stroke:#f57c00,stroke-width:2px;
    classDef Phase3 fill:#e8f5e9,stroke:#388e3c,stroke-width:2px;

    subgraph Phase_1 [The Clinical Puzzle]
        Patient(&quot;46M with Hx of&lt;br&gt;Atrial Pseudoaneurysm Repair&quot;)
        Presentation(&quot;New Onset:&lt;br&gt;Chest Pain, Headache,&lt;br&gt;Word-Finding Difficulty&quot;)
        Imaging(&quot;Multi-System Lesions:&lt;br&gt;Lungs (Halo Sign), Brain,&lt;br&gt;Pericardium, Bone&quot;)
        Lab(&quot;Key Lab Finding:&lt;br&gt;Peripheral Eosinophilia&quot;)
        Dilemma(&quot;The Dilemma:&lt;br&gt;Widespread disease in a&lt;br&gt;previously healthy world traveler&quot;)
    end

    subgraph Phase_2 [The Differential Debate]
        CentralQuestion(&quot;Central Question:&lt;br&gt;Infection vs. Malignancy?&quot;)
        InfectiousDDx(&quot;Hypothesis: Atypical Infection&lt;br&gt;• Mycobacterial (TB/NTM)&lt;br&gt;• Endemic Fungi&lt;br&gt;• Nocardia / Melioidosis&lt;br&gt;• Brucellosis&quot;)
        MalignancyDDx(&quot;Hypothesis: Malignancy / Inflammatory&lt;br&gt;• Lymphoma&lt;br&gt;• Sarcoma&lt;br&gt;• Histiocytosis&quot;)
        Workup(&quot;Extensive Infectious Workup:&lt;br&gt;BAL, CSF, Blood Cultures,&lt;br&gt;Serologies --&gt; All Negative&quot;)
        TurningPoint(&quot;The Turning Point:&lt;br&gt;Biopsy of Pericardial Lymph Node&quot;)
    end

    subgraph Phase_3 [Resolution &amp; Wisdom]
        Diagnosis(&quot;Final Diagnosis:&lt;br&gt;Cardiac Angiosarcoma&quot;)
        TeachingPoint1(&quot;Primary Teaching Point:&lt;br&gt;Angiosarcoma is a great mimicker&lt;br&gt;of infectious pericarditis &amp; sepsis&quot;)
        TeachingPoint2(&quot;Clinical Pearl:&lt;br&gt;Always consider malignancy when&lt;br&gt;an &#x27;infection&#x27; fails to respond&lt;br&gt;or has atypical features&quot;)
    end

    %% Flow
    Patient --&gt; Presentation --&gt; Imaging &amp; Lab
    Imaging --&gt; Dilemma
    Lab --&gt; Dilemma
    Dilemma --&gt; CentralQuestion
    CentralQuestion --&gt; InfectiousDDx
    CentralQuestion --&gt; MalignancyDDx
    InfectiousDDx --&gt; Workup
    MalignancyDDx --&gt; Workup
    Workup --&gt; TurningPoint
    TurningPoint --&gt; Diagnosis
    Diagnosis --&gt; TeachingPoint1
    TeachingPoint1 --&gt; TeachingPoint2

    %% Styling
    class Patient,Presentation,Imaging,Lab,Dilemma Phase1;
    class CentralQuestion,InfectiousDDx,MalignancyDDx,Workup,TurningPoint Phase2;
    class Diagnosis,TeachingPoint1,TeachingPoint2 Phase3;
            </pre>
            
            <div id="mermaid-output"></div>
        </div>
    </div>

    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        
        async function renderDiagram() {
            const sourceElement = document.querySelector('#graph-definition');
            const outputElement = document.querySelector('#mermaid-output');
            const graphDefinition = sourceElement.textContent;
            
            try {
                // Render the graph
                const { svg } = await mermaid.render('rendered-svg', graphDefinition);
                outputElement.innerHTML = svg;
                
                // Initialize Pan/Zoom on the new SVG
                const svgElement = outputElement.querySelector('svg');
                svgElement.setAttribute('width', '100%');
                svgElement.setAttribute('height', '100%');
                
                window.panZoomInstance = svgPanZoom(svgElement, {
                    zoomEnabled: true,
                    controlIconsEnabled: false,
                    fit: true,
                    center: true,
                    minZoom: 0.5,
                    maxZoom: 10
                });
            } catch (e) {
                outputElement.innerHTML = `<div style="color:red; padding:20px">Error rendering diagram: ${e.message}</div>`;
                console.error(e);
            }
        }

        renderDiagram();
    </script>

    <script>
        function resetZoom() {
            if (window.panZoomInstance) {
                window.panZoomInstance.reset();
                window.panZoomInstance.fit();
                window.panZoomInstance.center();
            }
        }
    </script>
</body>
</html>
    